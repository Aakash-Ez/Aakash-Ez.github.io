<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Generating text using CharRNN</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <!-- Slick Carousel -->
  <link rel="stylesheet" href="https://aakash-ez.github.io/plugins/slick/slick.css" />
  <link rel="stylesheet" href="https://aakash-ez.github.io/plugins/slick/slick-theme.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://aakash-ez.github.io/plugins/font-awesome/css/font-awesome.min.css" />

  <!-- Magnific Popup -->
  <link rel="stylesheet" href="https://aakash-ez.github.io/plugins/magnafic-popup/magnific-popup.css" />

  <!-- Stylesheets -->
  
  <link href="https://aakash-ez.github.io/scss/style.min.css" rel="stylesheet" />

  <!-- Stylesheets -->
  
  <link href="https://aakash-ez.github.io/scss/404.min.css" rel="stylesheet" />

  <!--Favicon-->
  <link rel="shortcut icon" href="https://aakash-ez.github.io/images/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="https://aakash-ez.github.io/images/favicon.png" type="image/x-icon" />
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HRRGJWNWEC"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-HRRGJWNWEC');
  </script>
  <link rel="stylesheet" type="text/css" href="https://pgn.chessbase.com/CBReplay.css" />

  <script src="https://pgn.chessbase.com/jquery-3.0.0.min.js"></script>
  <script src="https://pgn.chessbase.com/cbreplay.js" type="text/javascript"></script> 
  
</head>
<head>
<meta property="og:title" content="Generating text using CharRNN | AakEz" />
<meta name="twitter:title" content="Generating text using CharRNN | AakEz" />
<meta itemprop="name" content="Generating text using CharRNN | AakEz" />
<meta name="application-name" content="Generating text using CharRNN | AakEz" />
<meta property="og:site_name" content="https://aakash-ez.github.io/" />
<meta name="description" content="CharRNN stands for character RNN, where the network is used to predict the next character given a sequence of characters preceding it. This methodology can be used to generate texts given a starting sequence. However one of the major flow regarding this method is that as we are predicting one character at a time, it is possible to generate words that have no meanings." />
<meta itemprop="description" content="CharRNN stands for character RNN, where the network is used to predict the next character given a sequence of characters preceding it. This methodology can be used to generate texts given a starting sequence. However one of the major flow regarding this method is that as we are predicting one character at a time, it is possible to generate words that have no meanings." />
<meta property="og:description" content="CharRNN stands for character RNN, where the network is used to predict the next character given a sequence of characters preceding it. This methodology can be used to generate texts given a starting sequence. However one of the major flow regarding this method is that as we are predicting one character at a time, it is possible to generate words that have no meanings." />
<meta name="twitter:description" content="CharRNN stands for character RNN, where the network is used to predict the next character given a sequence of characters preceding it. This methodology can be used to generate texts given a starting sequence. However one of the major flow regarding this method is that as we are predicting one character at a time, it is possible to generate words that have no meanings." />
<meta name="robots" content="index,follow" /> 
<meta name="googlebot" content="index,follow" />
</head>
<body>
  <nav class="navbar navbar-expand-lg fixed-top">
  <div class="container">
    <a href="https://aakash-ez.github.io/" class="navbar-brand">
      <img src="https://aakash-ez.github.io/images/site-navigation/logo.png" alt="site-logo">
    </a>
    <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#navbarCollapse">
      <span class="navbar-toggler-icon"></span>
      <span class="navbar-toggler-icon"></span>
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
      <ul class="nav navbar-nav main-navigation my-0 mx-auto">
        
        
        <li class="nav-item">
          <a href="https://aakash-ez.github.io/#home"
            class="nav-link text-dark text-sm-center p-2 ">Home</a>
        </li>
        
        <li class="nav-item">
          <a href="https://aakash-ez.github.io//blog"
            class="nav-link text-dark text-sm-center p-2 ">Blog</a>
        </li>
        
        <li class="nav-item">
          <a href="https://aakash-ez.github.io//off-topic"
            class="nav-link text-dark text-sm-center p-2 ">Off Topic</a>
        </li>
        
        <li class="nav-item">
          <a href="https://aakash-ez.github.io//contact"
            class="nav-link text-dark text-sm-center p-2 ">Contact</a>
        </li>
        
      </ul>
    </div>
  </div>
</nav>
  <div id="content">
    

<header class="breadCrumb">
  <div class="container">
    <div class="row">
      <div class="col-lg-10 col-md-12 offset-lg-1 offset-md-0 text-center">
        <h3 class="breadCrumb__title">Generating text using CharRNN</h3>
        <nav aria-label="breadcrumb" class="d-flex justify-content-center">
          <ol class="breadcrumb align-items-center">
            <li class="breadcrumb-item"><a href=https://aakash-ez.github.io/>Home</a></li>
            <li class="breadcrumb-item"><a href=https://aakash-ez.github.io/blog>All Post</a></li>
            <li class="breadcrumb-item active">Aakash Ezhilan</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
</header>

<section class="section singleBlog">
  <div class="svg-img">
      <img src=https://aakash-ez.github.io/images/hero/figure-svg.svg alt="">
  </div>
  <div class="animate-shape">
      
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 600 600">
          <defs>
              <linearGradient id="d" x1="0.929" y1="0.111" x2="0.263" y2="0.935" gradientUnits="objectBoundingBox">
                  <stop offset="0" stop-color="#f1f6f9" />
                  <stop offset="1" stop-color="#f1f6f9" stop-opacity="0" />
              </linearGradient>
          </defs>
          <g data-name="blob-shape (3)">
              <path class="blob" fill="url(#d)"
                  d="M455.4 151.1c43.1 36.7 73.4 92.8 60.8 136.3-12.7 43.5-68.1 74.4-111.3 119.4-43.1 45-74 104.1-109.8 109-35.9 5-76.7-44.2-111.8-89.2-35.2-45-64.7-85.8-70.8-132.6-6-46.8 11.6-99.6 46.7-136.3 35.2-36.6 88-57.2 142.4-58.8 54.5-1.7 110.6 15.6 153.8 52.2z" />
          </g>
      </svg>
  </div>
  <div class="animate-pattern">
      <img src=https://aakash-ez.github.io/images/service/background-pattern.svg alt="background-shape">
  </div>
  <div class="container">
      <div class="row">
          <div class="col-lg-12">
              <div class="singleBlog__feature">
                  <img src=https://aakash-ez.github.io/images/blog/text-generation-rnn/featured.png alt="feature-image">
              </div>
          </div>
      </div>
      <div class="row mt-5">
          <div class="col-lg-12">
              <div class="singleBlog__content">
                  <p>In the last week’s blogpost we discussed about Recurrent Neural Networks and saw how it can be used in tweet classification. In today’s post we are going to continue with RNNs and look at how a simple architecture can generate texts.</p>
<p>CharRNN stands for character RNN, where the network is used to predict the next character given a sequence of characters preceding it. This methodology can be used to generate texts given a starting sequence. However one of the major flow regarding this method is that as we are predicting one character at a time, it is possible to generate words that have no meanings.</p>
<p>We will be used Shakespeare’s sonnets as our corpus to train our network. We have all the sonnets in a text file as shown in the below figure. Our first objective is to extract this text from the file and preprocess it, by removing the punctuations and changing all characters to lowercase.</p>
<div align="center">
    <img src="https://aakash-ez.github.io/images/blog/text-generation-rnn/image-1.png" style="max-width: 100%;"/>
    <i><div style="text-align: center">Figure 1. Shakespeare Sonnet 1 from the text file</div></i><br>
</div>
<h3 id="implementation">Implementation</h3>
<p>In the below code, we are going to remove the punctuations and extract the sonnet and convert them into sequence of characters.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> re
<span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;sonnets.txt&#39;</span>)
text <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)
text <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;[^\w\s]&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, text)
text <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;sonnet.*\n&#34;</span>, <span style="color:#e6db74">&#39;newpoem</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, text)
vocab <span style="color:#f92672">=</span> list(set(text))
text <span style="color:#f92672">=</span> [i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> text<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>) <span style="color:#66d9ef">if</span> i<span style="color:#f92672">!=</span><span style="color:#e6db74">&#34;&#34;</span>]
text<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)
sonnets <span style="color:#f92672">=</span> []
temp <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> text:
  <span style="color:#66d9ef">if</span> i <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;newpoem&#34;</span>:
    temp <span style="color:#f92672">+=</span> i<span style="color:#f92672">+</span><span style="color:#e6db74">&#34; </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
  <span style="color:#66d9ef">else</span>:
    sonnets<span style="color:#f92672">.</span>append(temp)
    temp <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</code></pre></div><p>Next we will be creating two dictionaries, one to convert a given number/index to character and other doing the opposite. Apart from this we will be defining vocab_size variable to store the size of our vocabulary, which is 28 in this case.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">i2c_dict <span style="color:#f92672">=</span> {}
c2i_dict <span style="color:#f92672">=</span> {}
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(vocab)):
  i2c_dict[i] <span style="color:#f92672">=</span> vocab[i]
  c2i_dict[vocab[i]] <span style="color:#f92672">=</span> i
vocab_size <span style="color:#f92672">=</span> len(vocab)
</code></pre></div><p>Using the character to index dictionary we had defined above, we are going to now encode the sequence of characters we had extracted from the sonnets into numbers. We are also going to define X and Y which we will use for training and testing our model. Our X is going to be a sequence of 50 characters (represented as numbers) and Y is going to be the character that comes right after the 50 characters. The output is going to be one-hot encoded so that we can treat this a multi-class classification problem.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">one_hot</span>(a,vocab_size):
  a <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(a)
  b <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((a<span style="color:#f92672">.</span>size, vocab_size))
  b[np<span style="color:#f92672">.</span>arange(a<span style="color:#f92672">.</span>size),a] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">return</span> b
X <span style="color:#f92672">=</span> []
Y <span style="color:#f92672">=</span> []
counter <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> sonnets:
  print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\r</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>str(counter)<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;/154&#34;</span>,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>)
  counter <span style="color:#f92672">=</span> counter <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">50</span>,len(i)):
    x_val <span style="color:#f92672">=</span> [c2i_dict[k] <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> i[j<span style="color:#f92672">-</span><span style="color:#ae81ff">50</span>:j]]
    y_val <span style="color:#f92672">=</span> one_hot([c2i_dict[i[j]]],vocab_size)
    X<span style="color:#f92672">.</span>append(x_val)
    Y<span style="color:#f92672">.</span>append(y_val)
X_array <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(X)<span style="color:#f92672">.</span>reshape(len(X),<span style="color:#ae81ff">50</span>,<span style="color:#ae81ff">1</span>)
Y_array <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(Y)<span style="color:#f92672">.</span>reshape(len(Y),vocab_size)
</code></pre></div><p>Let us now split the X and Y arrays for training and testing.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(X_array, Y_array, test_size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>, random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
</code></pre></div><p>We will now import the necessary functions from the Keras framework. We will be discussing the use of these functions later, when we use them.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">from</span> keras <span style="color:#f92672">import</span> Model
<span style="color:#f92672">from</span> keras.models <span style="color:#f92672">import</span> Sequential,load_model
<span style="color:#f92672">from</span> keras.layers <span style="color:#f92672">import</span> Dense, Dropout, LSTM, Embedding
<span style="color:#f92672">from</span> keras.callbacks <span style="color:#f92672">import</span> ModelCheckpoint, Callback
<span style="color:#f92672">from</span> keras.optimizers <span style="color:#f92672">import</span> Adam
</code></pre></div><p>Before defining our model, we are going to be defining a custom callback, named PredictCallback, which will predict the output for a given input at the end of each epoch. This will give us an idea on how well the model is performing at each epoch. We are going to be generating 50 characters using our model to understand the model’s performance better.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">nextinput</span>(x,pred):
    x <span style="color:#f92672">=</span> x[<span style="color:#ae81ff">1</span>:]
    pred <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>argmax(pred)
    x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>append(x,pred)
    <span style="color:#66d9ef">return</span> x,pred
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">printarray</span>(arr):
    string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> arr:
      string <span style="color:#f92672">=</span> string <span style="color:#f92672">+</span> i2c_dict[i[<span style="color:#ae81ff">0</span>]]
    <span style="color:#66d9ef">return</span> string
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PredictCallback</span>(Callback):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_epoch_end</span>(self, epoch, logs<span style="color:#f92672">=</span>{}):
        keys <span style="color:#f92672">=</span> list(logs<span style="color:#f92672">.</span>keys())
        inp <span style="color:#f92672">=</span> X_test[<span style="color:#ae81ff">10</span>]
        print(printarray(inp),end<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>)
        X_Val <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>reshape(inp,(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">50</span>,<span style="color:#ae81ff">1</span>))
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">50</span>):
            pred <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>predict([X_Val],verbose <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
            pred <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>reshape(pred,(<span style="color:#ae81ff">28</span>,<span style="color:#ae81ff">1</span>))
            inp,pred <span style="color:#f92672">=</span> nextinput(inp,pred)
            X_Val <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>reshape(inp,(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">50</span>,<span style="color:#ae81ff">1</span>))
            character <span style="color:#f92672">=</span> i2c_dict[pred]
            print(character,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>)
        print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><p>Let us now define our model. We are going to first add an embedding layer which will embed each character into a vector of length 256. Followed by this we are going to have an LSTM layer to under the sequence better. Finally we are going to have a fully connected network to determine the output.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_model</span>(inp_shape,batch_size,vocab_size):
    model <span style="color:#f92672">=</span> Sequential()
    model<span style="color:#f92672">.</span>add(Embedding(vocab_size,<span style="color:#ae81ff">256</span>,input_length<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>))
    model<span style="color:#f92672">.</span>add(LSTM(<span style="color:#ae81ff">512</span>, input_shape <span style="color:#f92672">=</span> (<span style="color:#66d9ef">None</span>,<span style="color:#ae81ff">50</span>,<span style="color:#ae81ff">256</span>), activation <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;relu&#39;</span>))
    model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">2048</span>,activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>))
    model<span style="color:#f92672">.</span>add(Dropout(<span style="color:#ae81ff">0.1</span>))
    model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">2048</span>,activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>))
    model<span style="color:#f92672">.</span>add(Dropout(<span style="color:#ae81ff">0.1</span>))
    model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">2048</span>,activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>))
    model<span style="color:#f92672">.</span>add(Dropout(<span style="color:#ae81ff">0.1</span>))
    model<span style="color:#f92672">.</span>add(Dense(vocab_size,activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;softmax&#39;</span>))
    <span style="color:#66d9ef">return</span> model
BATCH_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>
model <span style="color:#f92672">=</span> create_model(X_array[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>shape,BATCH_SIZE,vocab_size)
model<span style="color:#f92672">.</span>summary()
</code></pre></div><p>Next we will compile our model using Adam Optimizer and Categorical Crossentropy loss function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">opt <span style="color:#f92672">=</span> Adam(learning_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.0005</span>)
checkpoint <span style="color:#f92672">=</span> ModelCheckpoint(filepath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;model.</span><span style="color:#e6db74">{epoch:02d}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">{loss:.2f}</span><span style="color:#e6db74">.h5&#39;</span>)
callbacks_list <span style="color:#f92672">=</span> [checkpoint,PredictCallback()]
model<span style="color:#f92672">.</span>compile(optimizer<span style="color:#f92672">=</span>opt, loss<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;categorical_crossentropy&#39;</span>, metrics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;accuracy&#39;</span>])
</code></pre></div><p>It’s time to train our model. We are going to save the weights at the end of each epoch using ModelCheckpoint, while predicting the output in each epoch using the custom epoch that we had defined.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">history <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>fit(x<span style="color:#f92672">=</span>X_train,y<span style="color:#f92672">=</span>y_train,epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>,validation_split<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>,batch_size<span style="color:#f92672">=</span>BATCH_SIZE,validation_steps<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>,callbacks<span style="color:#f92672">=</span>callbacks_list,shuffle<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</code></pre></div><p>Once the model is trained (approximately takes 4 hours) we can use this model to predict the output for the testing data and compare it with the actual output. We can plot this as a confusion matrix to help in visualizing the output.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> seaborn <span style="color:#66d9ef">as</span> sns; sns<span style="color:#f92672">.</span>set_theme()
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> classification_report, confusion_matrix
y_pred <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test,verbose <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
y_pred_val <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>argmax(y_pred,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
y_test_val <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>argmax(y_test,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
cm <span style="color:#f92672">=</span> confusion_matrix(y_test_val, y_pred_val)
cm <span style="color:#f92672">=</span> (cm<span style="color:#f92672">.</span>T<span style="color:#f92672">/</span>cm<span style="color:#f92672">.</span>sum(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))<span style="color:#f92672">.</span>T
sns<span style="color:#f92672">.</span>heatmap(cm,xticklabels<span style="color:#f92672">=</span>vocab, yticklabels<span style="color:#f92672">=</span>vocab)
</code></pre></div><p>Below is the confusion matrix for the model. However the performance of the model will vary a little due to stochastic nature of the algorithm.</p>
<div align="center">
    <img src="https://aakash-ez.github.io/images/blog/text-generation-rnn/image-2.png" style="max-width: 100%;"/>
    <i><div style="text-align: center">Figure 2. Confusion Matrix for the developed model</div></i><br>
</div>
<p>The below is the output generated using our model, given the first 50 characters. while the model is able to generate words well. However, the structure of sentence is not well defined and the theme of the poem is completely post. This is because with each letter we predict, we are replying on the output of the model to predict the next one.</p>
<div align="center">
    <img src="https://aakash-ez.github.io/images/blog/text-generation-rnn/image-3.png" style="border: 1px solid #555; max-width: 100%;"/>
    <i><div style="text-align: center">Figure 3. Output using the given the model developed</div></i><br>
</div>
<p>You can find the code for this blogpost in <a href="https://github.com/Aakash-Ez/Blog_Programs/tree/main/CharRNN%20for%20Text%20Generation">this github repo</a>.</p>

              </div>
          </div>
      </div>
  </div>
</section>


  </div>
  <section class="footer" id="contact">
	<div class="footer__background_shape">
		<svg viewBox="0 0 1920 79">
			<path d="M0 0h1920v79L0 0z" data-name="Path 1450" />
		</svg>
	</div>
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div class="footer__cta">
					<div class="shape-1">
						<svg xmlns="http://www.w3.org/2000/svg" width="357" height="315.029" viewBox="0 0 357 315.029">
							<path data-name="Path 1449"
								d="M76.1-157.222C91.746-135.8 87.2-94.273 99.993-61.945c12.7 32.328 42.661 55.459 39.248 73.282-3.318 17.823-40.007 30.337-65.6 43.325-25.5 12.988-39.912 26.545-60.01 42.566-20.1 16.116-46.074 34.6-63.328 27.682-17.349-6.921-25.976-39.153-59.915-59.82s-93.1-29.768-105.325-51.478 22.373-56.028 43.609-93.949c21.331-37.921 29.2-79.35 53.563-96.793 24.459-17.444 65.414-10.9 103.9-6.921 38.396 3.982 74.326 5.404 89.965 26.829z"
								transform="translate(217.489 188.626)" />
						</svg>
					</div>
					<div class="shape-2">
						<svg xmlns="http://www.w3.org/2000/svg" width="357" height="315.029" viewBox="0 0 357 315.029">
							<path data-name="Path 1449"
								d="M76.1-157.222C91.746-135.8 87.2-94.273 99.993-61.945c12.7 32.328 42.661 55.459 39.248 73.282-3.318 17.823-40.007 30.337-65.6 43.325-25.5 12.988-39.912 26.545-60.01 42.566-20.1 16.116-46.074 34.6-63.328 27.682-17.349-6.921-25.976-39.153-59.915-59.82s-93.1-29.768-105.325-51.478 22.373-56.028 43.609-93.949c21.331-37.921 29.2-79.35 53.563-96.793 24.459-17.444 65.414-10.9 103.9-6.921 38.396 3.982 74.326 5.404 89.965 26.829z"
								transform="translate(217.489 188.626)" />
						</svg>
					</div>
					<div class="text-light footer__cta_content">
						<span>Contact me</span>
						<h2 class="mb-0">Let’s Start a Project</h2>
					</div>
					<div class="footer__cta_action">
						<a class="btn btn-light btn-zoom" href="https://aakash-ez.github.io/contact">Get in
							touch</a>
					</div>
				</div>
			</div>
		</div>
		<div class="row footer__widget">
			<div class="col-lg-4">
				<div class="footer__widget_logo mb-5">
					<img src="https://aakash-ez.github.io/images/contact/widget-logo.png" alt="widget-logo">
				</div>
			</div>
			
			<div class="col-lg-4">
				<div class="text-light footer__widget_address mb-5">
					<h4 class="base-font">Address</h4>
					
					<ul class="fa-ul small">
						<li class="mb-2"><a class="text-light" href="tel:&#43;%2891%29%20962%20936%205421"><span class="fa-li"><i
										class="fa fa-phone"></i></span>&#43;(91) 962 936 5421</a></li>
						<li class="mb-2"><a class="text-light" href="mailto:aakash.ezhilan@gmail.com"><span class="fa-li"><i
										class="fa fa-envelope"></i></span>aakash.ezhilan@gmail.com</a></li>
						<li class="mb-2">
							<span class="fa-li"><i class="fa fa-map-marker"></i></span>Chennai, Tamil Nadu, India. Pincode: 603103</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<div class="row footer__footer">
			<div class="col-lg-6">
				<div class="footer__footer_copy text-light">
					<p>Made on top of Portio Template</p>
				</div>
			</div>
			<div class="col-lg-6">
				<div class="footer__footer_social">
					<ul class="unstyle-list">
						
						
						<li class="d-inline-block mx-2"><a class="text-light" target="_blank" href="https://www.facebook.com/aakash.ezhilan"><i
									class="fa fa-facebook-official"></i></a>
						</li>
						
						<li class="d-inline-block mx-2"><a class="text-light" target="_blank" href="https://www.linkedin.com/in/aakash-ez"><i
									class="fa fa-linkedin-square"></i></a>
						</li>
						
						<li class="d-inline-block mx-2"><a class="text-light" target="_blank" href="https://github.com/Aakash-Ez/"><i
									class="fa fa-github-square"></i></a>
						</li>
						
						<li class="d-inline-block mx-2"><a class="text-light" target="_blank" href="https://twitter.com/aakash_ezhilan"><i
									class="fa fa-twitter-square"></i></a>
						</li>
						
					</ul>
				</div>
			</div>
		</div>
	</div>
</section>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR%20GOOGLE%20MAP%20API&libraries=geometry"></script>
<script src="https://aakash-ez.github.io/plugins/jQuery/jquery.min.js"></script>
<script src="https://aakash-ez.github.io/plugins/bootstrap/bootstrap.min.js"></script>
<script src="https://aakash-ez.github.io/plugins/slick/slick.min.js"></script>
<script src="https://aakash-ez.github.io/plugins/waypoint/jquery.waypoints.min.js"></script>
<script src="https://aakash-ez.github.io/plugins/magnafic-popup/jquery.magnific-popup.min.js"></script>
<script src="https://aakash-ez.github.io/plugins/tweenmax/TweenMax.min.js"></script>
<script src="https://aakash-ez.github.io/plugins/imagesloaded/imagesloaded.min.js"></script>
<script src="https://aakash-ez.github.io/plugins/masonry/masonry.min.js"></script>

<script src="https://aakash-ez.github.io/js/form-handler.min.js"></script>

<script src="https://aakash-ez.github.io/js/script.min.js"></script>

</body>

</html>