<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Smile detection using Haar Cascade Classifier</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <!-- Slick Carousel -->
  <link rel="stylesheet" href="http://example.org/plugins/slick/slick.css" />
  <link rel="stylesheet" href="http://example.org/plugins/slick/slick-theme.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="http://example.org/plugins/font-awesome/css/font-awesome.min.css" />

  <!-- Magnific Popup -->
  <link rel="stylesheet" href="http://example.org/plugins/magnafic-popup/magnific-popup.css" />

  <!-- Stylesheets -->
  
  <link href="http://example.org/scss/style.min.css" rel="stylesheet" />

  <!--Favicon-->
  <link rel="shortcut icon" href="http://example.org/images/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="http://example.org/images/favicon.png" type="image/x-icon" />
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR%20GOOGLE%20ANALYTICS%20CODE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'YOUR GOOGLE ANALYTICS CODE');
  </script>
  
</head>

<body>
  <nav class="navbar navbar-expand-lg fixed-top">
  <div class="container">
    <a href="http://example.org/" class="navbar-brand">
      <img src="http://example.org/images/site-navigation/logo.png" alt="site-logo">
    </a>
    <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#navbarCollapse">
      <span class="navbar-toggler-icon"></span>
      <span class="navbar-toggler-icon"></span>
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
      <ul class="nav navbar-nav main-navigation my-0 mx-auto">
        
        
        <li class="nav-item">
          <a href="http://example.org/#home"
            class="nav-link text-dark text-sm-center p-2 ">Home</a>
        </li>
        
        <li class="nav-item">
          <a href="http://example.org//off-topic"
            class="nav-link text-dark text-sm-center p-2 ">Off Topic</a>
        </li>
        
        <li class="nav-item">
          <a href="http://example.org//blog"
            class="nav-link text-dark text-sm-center p-2 ">Blog</a>
        </li>
        
        <li class="nav-item">
          <a href="http://example.org//contact"
            class="nav-link text-dark text-sm-center p-2 ">Contact</a>
        </li>
        
      </ul>
    </div>
  </div>
</nav>
  <div id="content">
    

<header class="breadCrumb">
  <div class="container">
    <div class="row">
      <div class="col-lg-10 col-md-12 offset-lg-1 offset-md-0 text-center">
        <h3 class="breadCrumb__title">Smile detection using Haar Cascade Classifier</h3>
        <nav aria-label="breadcrumb" class="d-flex justify-content-center">
          <ol class="breadcrumb align-items-center">
            <li class="breadcrumb-item"><a href=http://example.org/>Home</a></li>
            <li class="breadcrumb-item"><a href=http://example.org/blog>All Post</a></li>
            <li class="breadcrumb-item active">Aakash Ezhilan</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
</header>

<section class="section singleBlog">
  <div class="svg-img">
      <img src=http://example.org/images/hero/figure-svg.svg alt="">
  </div>
  <div class="animate-shape">
      
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 600 600">
          <defs>
              <linearGradient id="d" x1="0.929" y1="0.111" x2="0.263" y2="0.935" gradientUnits="objectBoundingBox">
                  <stop offset="0" stop-color="#f1f6f9" />
                  <stop offset="1" stop-color="#f1f6f9" stop-opacity="0" />
              </linearGradient>
          </defs>
          <g data-name="blob-shape (3)">
              <path class="blob" fill="url(#d)"
                  d="M455.4 151.1c43.1 36.7 73.4 92.8 60.8 136.3-12.7 43.5-68.1 74.4-111.3 119.4-43.1 45-74 104.1-109.8 109-35.9 5-76.7-44.2-111.8-89.2-35.2-45-64.7-85.8-70.8-132.6-6-46.8 11.6-99.6 46.7-136.3 35.2-36.6 88-57.2 142.4-58.8 54.5-1.7 110.6 15.6 153.8 52.2z" />
          </g>
      </svg>
  </div>
  <div class="animate-pattern">
      <img src=http://example.org/images/service/background-pattern.svg alt="background-shape">
  </div>
  <div class="container">
      <div class="row">
          <div class="col-lg-12">
              <div class="singleBlog__feature">
                  <img src=http://example.org/images/blog/haar-cascade/featured.png alt="feature-image">
              </div>
          </div>
      </div>
      <div class="row mt-5">
          <div class="col-lg-12">
              <div class="singleBlog__content">
                  <p>Face detection is one of the most popular application of computer vision, with even the modern smartphones having face recognition based locking system. It also acts as a stepping stone to enter the domain of computer vision, which has been revolutionizing various fields from surgical procedures to self driving cars.</p>
<p>One of the earliest ideas behind face detection was proposed by Viola and Jones in their paper <a href="https://ieeexplore.ieee.org/document/990517">Rapid object detection using a boosted cascade of simple features</a>, where they proposed the usage of haar-like features to determine whether a given image contains human face and if so, where.</p>
<p>Haar-like features in Viola-Jones Algorithm are simple rectangular features that maybe present within the provided image at any position or scale. These help in determining the existence/absence of certain characteristics or pattern in the image. Figure 1, depicts a simple Haar-Like Feature which checks for rectangular blocks within the image where the bottom half is significantly brighter than the upper half.</p>
<div align="center">
    <img src="http://example.org/images/blog/haar-cascade/simple.png" style="border: 1px solid #555; max-width: 100%;"/>
    <i><div style="text-align: center">Figure 1. A simple rectangular Haar-Like Feature</div></i><br>
</div>
<p>However the issue is when we consider various possible filters, even for a image of 24×24 there will be around 160000 features. For each of these feature we have to compute the sum of pixels under the brighter and darker region. To solve this, we are going to consider <a href="https://in.mathworks.com/help/images/integral-image.html">integral image</a>, thus reducing the computation to mere 4 pixels.</p>
<p>Another thing observed in Viola-Jones Algorithm is that most of the features do not contribute much. Therefore we will be wasting resources computing the features which contribute almost nothing towards our end result. To select the best features for face detection, we consider a training dataset, some of which contain face while others don’t. Now we train all the features over the dataset, and identify which features are able to classify the images with least error (The actual algorithm used is called Adaboost). In the paper mentioned above, the authors were able to achieve 95% accuracy with mere 200 filters. The final model proposed had 6000 filters.</p>
<div align="center">
    <img src="http://example.org/images/blog/haar-cascade/viola-jones.PNG" style="border: 1px solid #555; max-width: 100%;"/>
    <i><div style="text-align: center">Figure 2. Features that are able to detect important features like eyebrows etc. (Taken for Viola Jones Paper)</div></i><br>
</div>
<p>Now we are able to detect a face in the image however in an image, most of the region is non-face region and therefore processing over them will be inefficient. This was addressed by the authors by introducing a cascade of classifiers, wherein instead of applying all 6000 filters together, they are divided into group of filters applied one-by-one. If a region within the image fails the very first stage, it is discarded.</p>
<p>The author’s final detector had 38 such stages with the first five stages having 1, 10, 25, 25 and 50 filters respectively.</p>
<hr>
<p>Let us now try to implement the above discussed concepts using OpenCV library of python. First we’ll try to generate integral images for a given grayscale image. For this, first we’ll import the necessary libraries, which are OpenCV (cv2) and numpy.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> cv2
<span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</code></pre></div><p>Now, we need to import the image and identify the dimension of the image (rows and columns)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(<span style="color:#e6db74">&#34;regular_image.png&#34;</span>)
image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>cvtColor(image, cv2<span style="color:#f92672">.</span>COLOR_BGR2GRAY)
rows, cols <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>shape
</code></pre></div><p>We’ll define a numpy array filled with zeros which will act as the destination for the integral image.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">dest <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((rows,cols),np<span style="color:#f92672">.</span>float32)
</code></pre></div><p>We’ll generate the integral image for the input image using OpenCV function “integral”. The image is then normalized so that we can visualize it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">integral_image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>integral(image,dest,cv2<span style="color:#f92672">.</span>CV_32F)
cv2<span style="color:#f92672">.</span>normalize(integral_image, integral_image, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, cv2<span style="color:#f92672">.</span>NORM_MINMAX) 
</code></pre></div><p>Let us now print the original image and the integral image.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">cv2<span style="color:#f92672">.</span>imshow(<span style="color:#e6db74">&#39;Original Image&#39;</span>,image)
cv2<span style="color:#f92672">.</span>imshow(<span style="color:#e6db74">&#34;Integral Image&#34;</span>,integral_image)
cv2<span style="color:#f92672">.</span>waitKey()
</code></pre></div><hr>
<p>Next up, let us try to implement Haar Cascade Classifier. For this we are going to use the already trained cascades available <a href="https://github.com/opencv/opencv/tree/master/data/haarcascades">here</a>. We are going to be using the default frontal face cascade and the smile cascade in this example.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
<span style="color:#f92672">import</span> cv2
 
face_cascade <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>CascadeClassifier(<span style="color:#e6db74">&#39;haarcascade_frontalface_default.xml&#39;</span>)
smile_cascade <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>CascadeClassifier(<span style="color:#e6db74">&#39;haarcascade_smile.xml&#39;</span>)
</code></pre></div><p>Now that we have imported the required cascade classifiers, let us import the image we are going to test it on. The imported image is converted to grayscale.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(<span style="color:#e6db74">&#39;image.jpg&#39;</span>)
gray <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>cvtColor(img, cv2<span style="color:#f92672">.</span>COLOR_BGR2GRAY)
</code></pre></div><p>Now using the face cascade we will detect the occurrence of faces in our image, and loop through each face to check if we can detect a smile or not. We will be drawing bounding boxes around every face we identify (blue in color) and smile (green in color).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">faces <span style="color:#f92672">=</span> face_cascade<span style="color:#f92672">.</span>detectMultiScale(gray)
<span style="color:#66d9ef">for</span> (x,y,w,h) <span style="color:#f92672">in</span> faces:
    img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>rectangle(img,(x,y),(x<span style="color:#f92672">+</span>w,y<span style="color:#f92672">+</span>h),(<span style="color:#ae81ff">255</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>),<span style="color:#ae81ff">2</span>)
    roi_gray <span style="color:#f92672">=</span> gray[y:y<span style="color:#f92672">+</span>h, x:x<span style="color:#f92672">+</span>w]
    roi_color <span style="color:#f92672">=</span> img[y:y<span style="color:#f92672">+</span>h, x:x<span style="color:#f92672">+</span>w]
    smile <span style="color:#f92672">=</span> smile_cascade<span style="color:#f92672">.</span>detectMultiScale(roi_gray)
    <span style="color:#66d9ef">for</span> (sx,sy,sw,sh) <span style="color:#f92672">in</span> smile:
        cv2<span style="color:#f92672">.</span>rectangle(roi_color,(sx,sy),(sx<span style="color:#f92672">+</span>sw,sy<span style="color:#f92672">+</span>sh),(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">255</span>,<span style="color:#ae81ff">0</span>),<span style="color:#ae81ff">2</span>)
</code></pre></div><p>Now let us the display the image and see how well is the image able to detect a smile.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">cv2<span style="color:#f92672">.</span>imshow(<span style="color:#e6db74">&#39;img&#39;</span>,img)
cv2<span style="color:#f92672">.</span>waitKey()
</code></pre></div><div align="center">
    <img src="http://example.org/images/blog/haar-cascade/output.png" style="border: 1px solid #555; max-width: 100%;"/>
    <i><div style="text-align: center">Figure 3. The output of smile detection program using OpenCV and Haar Cascade Classifier</div></i><br>
</div>
<hr>
<p>Congrats on successfully implementing a smile detector! You can find all the codes and input files used in the blog post over here, along with a code for eye detection on webcam video: <a href="https://github.com/Aakash-Ez/Blog_Programs/tree/main/Week%201%20-%2029_Nov_2020">GitHub Week 1 – Smile Detection</a></p>

              </div>
          </div>
      </div>
  </div>
</section>


  </div>
  <section class="footer" id="contact">
	<div class="footer__background_shape">
		<svg viewBox="0 0 1920 79">
			<path d="M0 0h1920v79L0 0z" data-name="Path 1450" />
		</svg>
	</div>
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div class="footer__cta">
					<div class="shape-1">
						<svg xmlns="http://www.w3.org/2000/svg" width="357" height="315.029" viewBox="0 0 357 315.029">
							<path data-name="Path 1449"
								d="M76.1-157.222C91.746-135.8 87.2-94.273 99.993-61.945c12.7 32.328 42.661 55.459 39.248 73.282-3.318 17.823-40.007 30.337-65.6 43.325-25.5 12.988-39.912 26.545-60.01 42.566-20.1 16.116-46.074 34.6-63.328 27.682-17.349-6.921-25.976-39.153-59.915-59.82s-93.1-29.768-105.325-51.478 22.373-56.028 43.609-93.949c21.331-37.921 29.2-79.35 53.563-96.793 24.459-17.444 65.414-10.9 103.9-6.921 38.396 3.982 74.326 5.404 89.965 26.829z"
								transform="translate(217.489 188.626)" />
						</svg>
					</div>
					<div class="shape-2">
						<svg xmlns="http://www.w3.org/2000/svg" width="357" height="315.029" viewBox="0 0 357 315.029">
							<path data-name="Path 1449"
								d="M76.1-157.222C91.746-135.8 87.2-94.273 99.993-61.945c12.7 32.328 42.661 55.459 39.248 73.282-3.318 17.823-40.007 30.337-65.6 43.325-25.5 12.988-39.912 26.545-60.01 42.566-20.1 16.116-46.074 34.6-63.328 27.682-17.349-6.921-25.976-39.153-59.915-59.82s-93.1-29.768-105.325-51.478 22.373-56.028 43.609-93.949c21.331-37.921 29.2-79.35 53.563-96.793 24.459-17.444 65.414-10.9 103.9-6.921 38.396 3.982 74.326 5.404 89.965 26.829z"
								transform="translate(217.489 188.626)" />
						</svg>
					</div>
					<div class="text-light footer__cta_content">
						<span>Contact me</span>
						<h2 class="mb-0">Let’s Start a Project</h2>
					</div>
					<div class="footer__cta_action">
						<a class="btn btn-light btn-zoom" href="http://example.org/contact">Get in
							touch</a>
					</div>
				</div>
			</div>
		</div>
		<div class="row footer__widget">
			<div class="col-lg-4">
				<div class="footer__widget_logo mb-5">
					<img src="http://example.org/images/contact/widget-logo.png" alt="widget-logo">
				</div>
			</div>
			
			<div class="col-lg-4">
				<div class="text-light footer__widget_address mb-5">
					<h4 class="base-font">Address</h4>
					
					<ul class="fa-ul small">
						<li class="mb-2"><a class="text-light" href="tel:&#43;%2891%29%20962%20936%205421"><span class="fa-li"><i
										class="fa fa-phone"></i></span>&#43;(91) 962 936 5421</a></li>
						<li class="mb-2"><a class="text-light" href="mailto:aakash.ezhilan@gmail.com"><span class="fa-li"><i
										class="fa fa-envelope"></i></span>aakash.ezhilan@gmail.com</a></li>
						<li class="mb-2">
							<span class="fa-li"><i class="fa fa-map-marker"></i></span>Chennai, Tamil Nadu, India. Pincode: 603103</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<div class="row footer__footer">
			<div class="col-lg-6">
				<div class="footer__footer_copy text-light">
					<p>Made on top of Portio Template</p>
				</div>
			</div>
			<div class="col-lg-6">
				<div class="footer__footer_social">
					<ul class="unstyle-list">
						
						
						<li class="d-inline-block mx-2"><a class="text-light" target="_blank" href="https://www.facebook.com/aakash.ezhilan"><i
									class="fa fa-facebook-official"></i></a>
						</li>
						
						<li class="d-inline-block mx-2"><a class="text-light" target="_blank" href="https://www.linkedin.com/in/aakash-ez"><i
									class="fa fa-linkedin-square"></i></a>
						</li>
						
						<li class="d-inline-block mx-2"><a class="text-light" target="_blank" href="https://github.com/Aakash-Ez/"><i
									class="fa fa-github-square"></i></a>
						</li>
						
						<li class="d-inline-block mx-2"><a class="text-light" target="_blank" href="https://twitter.com/aakash_ezhilan"><i
									class="fa fa-twitter-square"></i></a>
						</li>
						
					</ul>
				</div>
			</div>
		</div>
	</div>
</section>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR%20GOOGLE%20MAP%20API&libraries=geometry"></script>
<script src="http://example.org/plugins/jQuery/jquery.min.js"></script>
<script src="http://example.org/plugins/bootstrap/bootstrap.min.js"></script>
<script src="http://example.org/plugins/slick/slick.min.js"></script>
<script src="http://example.org/plugins/waypoint/jquery.waypoints.min.js"></script>
<script src="http://example.org/plugins/magnafic-popup/jquery.magnific-popup.min.js"></script>
<script src="http://example.org/plugins/tweenmax/TweenMax.min.js"></script>
<script src="http://example.org/plugins/imagesloaded/imagesloaded.min.js"></script>
<script src="http://example.org/plugins/masonry/masonry.min.js"></script>

<script src="http://example.org/js/form-handler.min.js"></script>

<script src="http://example.org/js/script.min.js"></script>

</body>

</html>